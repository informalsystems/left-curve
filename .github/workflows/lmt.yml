name: LMT Check

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  lmt-check:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./quint
    steps:
    # Step 1: Checkout the repository
    - name: Checkout code
      uses: actions/checkout@v3

    # Step 2: Install Go
    - name: Install Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.20' # Replace with the required Go version

    # Step 3: Clone and build `lmt`
    - name: Build LMT
      run: |
        go install github.com/driusan/lmt@latest
        export PATH=$PATH:$(go env GOPATH)/bin

    # Step 4: Run `lmt` and fail if differences are detected
    - name: Run LMT
      run: |
        lmt proofs.md
        lmt invariants.md
        lmt tree_manipulation.md
        lmt grug_ics23.md
        lmt proof_types.md
        # Check that it is up to date
        git diff --exit-code \
          || ( echo ">>> ERROR: Tangled files are out of sync." &&  exit 1)


